синтаксис ClickHouse
### 1.1
я предполагаю, что в таблице players у некоторых пользователей возможно наличие нескольких дат установки приложения
```SQL
with installs as (
  select
    player_id,
    min(signup_date) as install_date
  from players
  group by 1
  having today() - install_date <= 30 
    and today() - install_date >= 8
),

au as (
  select
    player_id,
    session_start,
    install_date
  from sessions right join installs using player_id
  where today() - session_start <= 30 
)

select
  uniqExact(player_id) as all_users,
  uniqExactIf(player_id, date_diff(‘day’, install_date, session_start) >= 7) as d7,
  d7/all_users*100 as rr7
from au
```

### 1.2
как и в запросе выше, я предполагаю, что, возможно, у некоторых пользователей было изменение страны
```SQL
with player_info as (
  select
    player_id,
    if(today() - last_login <= 3, 1, 0) as au,
    argMin(country, signup_date) as country
  from players
  group by 1, 2
),

all_data as (
  select
    player_id,
    country,
    au,
    sum(amount_usd) as player_revenue
  from player_info left join payments using player_id
  group by 1, 2, 3
),

top_countries as (
  select
    country,
    sum(player_revenue) as country_revenue
  from all_data
  group by 1
  order by 2 desc
  limit 5
),

select
  player_id,
  country,
  player_revenue
from all_data inner join top_countries using country
where au = 1
order by play_revenue desc
limit 10 by country
```


### 1.3
по условию не совсем понятно, что понимается под прохождением квестов, в моем понимании - квест пройден успешно
```SQL
select
  location_id,
  avg(quest_duration) as avg_duration
from quests_attempts
where quest_result = 1
group by 1
order by 2 desc
```

### 2
По описанию нам известно только то, что тест проходил с 1 июля по 1 августа,
чтобы принять решение, нужна еще информация о:
- собственно, а какую метрику мы оцениваем, у нас указано две, нужна одна ключевая, остальное можно посмотреть, чтобы не уронить показатели 
- какое изменение мы предполагаем увидеть по результатам теста (к примеру: увеличение r1 на 2%)
- размер каждой из групп
- все ли у нас в группах нормально, в плане нет ли перекоса по количеству или странам, сорсам и тп

Ответ: нужно больше информации))

PS Ну и в целом, если команда захочет узнать, а все же из-за чего (обновленного тутора или редизайна) у нас произошли изменения - это мы не скажем 

### 3 
Общие фильтры:
- date_start, date_end (период, за который смотрим метрики)
- install_date_start, install_date_end (фильтр по дате инсталла пользователей)
- version (фильтр по версиям, включает параметр ALL)
- platform (фильтр по платформе)
- country (фильтр по странам, включает параметр ALL)
- media_source (по какому сорсу пришли пользователи, включает параметр ALL)
- incent (исключение/включение мотивированного трафика)

Дашборд будем делать один, но все равно хочется визуально разделить его на блоки:

первый блок : общая информация
- DAU, NU по дням
- NU по дням с группировкой по странам
- NU по дням с группировкой по сорсу
- DAU по дням с группировкой по версиям
(если мы видим изменения по метрикам (в данных ниже), то первые три графика помогут нам понять, были ли они связаны в тч с изменениями в закупке)

второй блок: удержание, вовлеченность
(т.е. сразу мы видим одну из основных метрик - удержание, далее - уже более точечные метрики, срезы)
- R1, R3, R7, R30, R90 по дням
- RR1, RR3, RR7, RR30, RR90 по дням
- длина сессий по дням
- частота сессий по дням
- воронка прохождения туториала (если есть)
- воронка по первой сессии/по 0 дню
- воронки по конверсиям в прохождение квестов, локаций
- сделать, к примеру, в виде таблицы: конверсию по прохождение квестов (с первой попытки и в целом), количество попыток, средняя/медианная длительность квестов, длительность прохождения локаций
- сделать распределение по последним событиям, после которых пользователи отвалились (не заходили минимум 7 дней)

третий блок : ресурсы, покупки, реклама
- среднее/медианное количество ресурсов, их траты по локациям и/или дням от инсталла
- топ оферов по конверсии в покупку, по arpu
- когда покупают оферы (момент игры и/или день инсталла)
- arppu по дням от инсталла
- arpu по локациям
- %dau смотрящих реворд рекламы, частота просмотров (+ в разрезе локаций просмотра)
- arpdau всего и в разрезе покупки/реклама

четвертый блок : доходность
- окупаемость по дням от инсталла
- накопительный arpu по дням от инсталла
 









